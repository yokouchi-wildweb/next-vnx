# ベーステンプレート自己評価基準

## 概要

### 目的
このドキュメントは、ベーステンプレートの完成度を客観的に評価するための基準を定義する。
外部に公開しても恥ずかしくない品質を担保し、派生リポジトリの開発者が安心して利用できる状態を目指す。

### 評価の実施タイミング
- 大きな機能追加・変更の完了後
- 定期的なマイルストーン時点
- 外部公開・共有の前

---

## 評価スケール

| スコア | 状態 | 説明 |
|--------|------|------|
| A | 完成 | 本番利用可能、改善の余地なし |
| B | 実用可 | 基本機能は完成、軽微な課題あり |
| C | 開発中 | 主要機能は動作、一部未実装 |
| D | 未成熟 | 基盤のみ、実用には追加作業必要 |
| E | 未着手 | 未実装または機能していない |

---

## 評価の実施方法

### 二段階評価プロセス

評価の品質と網羅性を担保するため、以下の二段階プロセスで実施する。

#### 第1段階: 俯瞰評価（セッション1）

**目的**: 全体像の把握と大まかなスコアリング

**方法**:
1. 全9項目を1セッションで通しで評価
2. 各項目に対して主要な観点のみ確認（深掘りしない）
3. 仮スコアと主要な課題を記録
4. 所要時間目安: 30-60分

**成果物**: 仮評価サマリー

#### 第2段階: 項目別深掘り評価（セッション2以降）

**目的**: 各項目の詳細な分析と見落としの防止

**方法**:
1. **必ず新規セッションで開始する**（俯瞰評価のバイアスを排除）
2. 1項目ずつ詳細に評価
3. 各項目の評価完了後、以下のレビューチェックを実施:

```markdown
### 項目N 評価レビューチェック
- [ ] 観点リストの全項目を確認したか
- [ ] 参照先のファイル/ドキュメントを実際に読んだか
- [ ] 俯瞰評価時の仮スコアと乖離がある場合、その理由を説明できるか
- [ ] 「良い点」に見落としがないか
- [ ] 「課題」は具体的で改善可能な形で記述されているか
- [ ] 「推奨アクション」は優先度順に並んでいるか
```

4. 必要に応じてユーザーに中間確認を取る
5. 所要時間目安: 1項目あたり10-20分

**成果物**: 詳細評価結果

### 評価結果の統合

1. 俯瞰評価と項目別評価のスコアを比較
2. 乖離がある場合は項目別評価を優先（より詳細な分析に基づくため）
3. 乖離の理由を「次回評価への申し送り」に記録

### セッション分割の重要性

| 観点 | 同一セッション | 別セッション |
|------|---------------|-------------|
| コンテキスト制約 | 累積で制約が厳しくなる | 各セッションで余裕がある |
| 認知バイアス | 前の評価に引きずられる | フレッシュな視点で評価 |
| 見落としリスク | 疲労で増加 | 各項目に集中可能 |

**推奨**: 俯瞰評価と項目別評価は必ず別セッションで実施する

---

## 評価項目

### 1. テンプレートとしての即時利用性

**観点:**
- [ ] 初期セットアップが容易か（クイックスタートからデプロイまで）
- [ ] ドメイン生成ツール（`dc:generate`）が安定動作するか
- [ ] 最小限の設定で開発サーバーが起動するか
- [ ] `.env.example` が整備されているか
- [ ] セットアップ時のエラーメッセージが分かりやすいか

**評価方法:**
新規クローンからの初期セットアップを実際に試行し、躓くポイントを確認する。

**参照先:**
- `docs/how-to/initial-setup/`
- `scripts/domain-config/`
- `.env.example`

---

### 2. レイヤー構造の一貫性（縦方向）

**観点:**
- [ ] 8層レイヤー構造が全ドメインで遵守されているか
- [ ] 命名規則（ファイル名、変数名、コンポーネント名）が統一されているか
- [ ] レイヤー間の依存関係が正しいか（上位層から下位層への一方向依存）
- [ ] HTTPクライアントポリシー（クライアント側はaxios）が守られているか
- [ ] DBアクセスがServer Service経由のみで行われているか

**評価方法:**
各ドメインのコードを抽出し、アーキテクチャガイドラインとの差異を確認する。

**参照先:**
- `docs/!must-read/アプリ構築における構成層.md`
- `src/features/*/`
- `CLAUDE.md`

---

### 3. ドメイン境界の責務分離（横方向）

**観点:**
- [ ] ドメイン間の依存関係が適切か（不正な横断参照がないか）
- [ ] 各ドメインが単一責任を持っているか
- [ ] ドメイン間で共有すべきロジックが適切に `lib/` や `core/` に配置されているか
- [ ] ドメイン固有のエンティティが他ドメインから直接参照されていないか
- [ ] ドメイン間の通信が適切なインターフェース経由で行われているか

**評価方法:**
各ドメインの import 文を分析し、不正な依存関係がないか確認する。ドメイン間の結合度を評価する。

**参照先:**
- `src/features/*/`
- `src/lib/`
- `src/features/core/`

---

### 4. 拡張性・カスタマイズ性

**観点:**
- [ ] カスタマイズすべき箇所と触らない箇所の境界が明確か
- [ ] 新規ドメイン追加のワークフローが確立されているか
- [ ] `domain.json` から生成されるファイルが適切か
- [ ] 生成コードの上書きと手動編集の共存ルールがあるか
- [ ] 共通処理の拡張ポイントが用意されているか

**評価方法:**
新規ドメインを追加するシナリオを実行し、手順の明確さと拡張のしやすさを確認する。

**参照先:**
- `docs/how-to/implementation/アプリへの新規ドメイン追加ガイド.md`
- `docs/how-to/utility/ドメインファイル自動生成に関するコマンド使用方法.md`
- `scripts/domain-config/`
- `src/features/*/domain.json`

---

### 5. コアライブラリの品質

**観点:**
- [ ] `src/lib/` の各モジュールが安定動作するか
- [ ] 共通コンポーネント（`src/components/`）が網羅的か
- [ ] エラーハンドリングが統一されているか（HttpError, DomainError）
- [ ] CRUD システム（`createCrudService`）が期待通り動作するか
- [ ] ユーティリティ関数のドキュメント・型定義が整備されているか

**評価方法:**
コアライブラリを使用した機能の動作確認、型定義の網羅性チェック。

**参照先:**
- `src/lib/`
- `src/components/`
- `src/components/README.md`
- `docs/core-specs/`

---

### 6. ドキュメントの充実度

**観点:**
- [ ] `CLAUDE.md` がプロジェクトの全体像を網羅しているか
- [ ] `docs/` 配下のドキュメントが最新の実装と整合しているか
- [ ] コードの自己説明性が高いか（適切な命名、必要な箇所のコメント）
- [ ] 必読ドキュメント（`!must-read`）が開発開始に十分か
- [ ] トラブルシューティングガイドが実用的か

**評価方法:**
ドキュメントを読みながら実装を追い、齟齬や不足を確認する。

**参照先:**
- `CLAUDE.md`
- `docs/`
- `docs/README.md`

---

### 7. セキュリティ

**観点:**
- [ ] 入力バリデーションが適切か（SQLインジェクション、XSS対策）
- [ ] 認証・認可の実装が安全か（セッション固定攻撃対策など）
- [ ] CSRF対策が施されているか
- [ ] 環境変数・シークレットの管理が適切か（漏洩リスクがないか）
- [ ] エラーメッセージで内部情報が漏洩しないか
- [ ] 依存パッケージに既知の脆弱性がないか

**評価方法:**
OWASP Top 10などのセキュリティチェックリストとの照合、コードレビューによる脆弱性の確認。

**参照先:**
- `src/lib/errors/`
- `src/features/core/auth/`
- `src/proxies/`
- `.env.example`
- `package.json`（依存パッケージ）

---

### 8. 派生リポジトリへの配慮

**観点:**
- [ ] 上流（ベース）の変更を派生リポジトリにマージしやすい構造か
- [ ] 変更可能な領域と変更禁止領域が明確に文書化されているか
- [ ] 派生リポジトリ作成時のガイドラインがあるか
- [ ] ベース固有の設定と案件固有の設定が分離されているか
- [ ] 競合が発生しにくいファイル構成になっているか

**評価方法:**
派生リポジトリを想定したブランチを作成し、ベースの変更をマージするシミュレーションを行う。

**参照先:**
- `CLAUDE.md`（System Core Files セクション）
- `docs/テンプレート利用ガイド.md`

---

### 9. テスト・品質保証

**観点:**
- [ ] ユニットテストのサンプル・パターンが提供されているか
- [ ] E2E テストの基盤が整備されているか
- [ ] CI/CD パイプラインが設定されているか
- [ ] テスト実行方法がドキュメント化されているか
- [ ] 品質を担保するためのレビュー観点が明確か

**評価方法:**
テストの実行、CI 設定の確認、テストカバレッジの計測。

**参照先:**
- `__tests__/`（存在する場合）
- `.github/workflows/`（存在する場合）
- `package.json`（test スクリプト）
- `playwright.config.ts`（存在する場合）

---

## 評価結果ファイルの書式

### ファイル命名規則
```
YYYY-MM-DD.md
```
例: `2024-12-20.md`

### 記載項目

```markdown
# 評価結果: YYYY-MM-DD

## 評価方式
- [ ] 俯瞰評価のみ
- [ ] 項目別評価のみ
- [x] 二段階評価（俯瞰 + 項目別）

## サマリー
| 項目 | スコア | 前回比 |
|------|--------|--------|
| 1. 即時利用性 | B | → |
| 2. レイヤー構造一貫性 | A | ↑ |
| 3. ドメイン境界分離 | A | - |
| ... | ... | ... |

**総合評価**: X

## 詳細評価

### 1. テンプレートとしての即時利用性 [スコア]

**良い点**:
- ...

**課題**:
- ...

**推奨アクション**:
- [ ] ...

（以下、各項目について同様）

## 俯瞰評価との乖離
（項目別評価で俯瞰評価と異なるスコアになった場合、その理由を記載）

## 次回評価への申し送り
- ...
```

### 前回比の記号
- `↑` : 改善
- `→` : 変化なし
- `↓` : 悪化
- `-` : 前回なし（初回評価）または新規項目
