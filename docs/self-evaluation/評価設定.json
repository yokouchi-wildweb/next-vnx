{
  "$schema": "評価実行用の構造化設定ファイル",
  "version": "1.0",
  "lastUpdated": "2025-12-20",

  "executionModes": {
    "overview": {
      "description": "俯瞰評価 - 全項目を浅く確認し仮スコアを付与",
      "scope": "全9項目を1セッションで通しで評価",
      "depth": "主要な観点のみ確認、深掘りしない",
      "output": "仮スコアと主要課題の記録",
      "timeEstimate": "30-60分"
    },
    "detailed": {
      "description": "項目別深掘り評価 - 1項目ずつ詳細に分析",
      "scope": "1項目ずつ評価",
      "depth": "観点リストの全項目を確認、参照先を実際に読む",
      "output": "詳細評価結果",
      "timeEstimate": "1項目あたり10-20分",
      "requirement": "必ず新規セッションで開始する（俯瞰評価のバイアス排除）"
    }
  },

  "scale": {
    "A": { "label": "完成", "description": "本番利用可能、改善の余地なし" },
    "B": { "label": "実用可", "description": "基本機能は完成、軽微な課題あり" },
    "C": { "label": "開発中", "description": "主要機能は動作、一部未実装" },
    "D": { "label": "未成熟", "description": "基盤のみ、実用には追加作業必要" },
    "E": { "label": "未着手", "description": "未実装または機能していない" }
  },

  "items": [
    {
      "id": 1,
      "name": "テンプレートとしての即時利用性",
      "checkpoints": [
        "初期セットアップが容易か（クイックスタートからデプロイまで）",
        "ドメイン生成ツール（dc:generate）が安定動作するか",
        "最小限の設定で開発サーバーが起動するか",
        ".env.example が整備されているか",
        "セットアップ時のエラーメッセージが分かりやすいか"
      ],
      "references": [
        "docs/how-to/initial-setup/",
        "scripts/domain-config/",
        ".env.example"
      ],
      "verificationPatterns": [
        { "type": "file_exists", "path": ".env.example" },
        { "type": "file_exists", "path": "docs/how-to/initial-setup/" },
        { "type": "script_exists", "name": "dc:generate" }
      ]
    },
    {
      "id": 2,
      "name": "レイヤー構造の一貫性（縦方向）",
      "checkpoints": [
        "8層レイヤー構造が全ドメインで遵守されているか",
        "命名規則（ファイル名、変数名、コンポーネント名）が統一されているか",
        "レイヤー間の依存関係が正しいか（上位層から下位層への一方向依存）",
        "HTTPクライアントポリシー（クライアント側はaxios）が守られているか",
        "DBアクセスがServer Service経由のみで行われているか"
      ],
      "references": [
        "docs/!must-read/アプリ構築における構成層.md",
        "src/features/*/",
        "CLAUDE.md"
      ],
      "verificationPatterns": [
        { "type": "grep", "pattern": "from 'axios'", "path": "src/features/*/services/client/", "expect": "exists" },
        { "type": "grep", "pattern": "fetch\\(", "path": "src/features/*/services/client/", "expect": "not_exists" },
        { "type": "grep", "pattern": "from.*drizzle", "path": "app/api/", "expect": "not_exists" }
      ]
    },
    {
      "id": 3,
      "name": "ドメイン境界の責務分離（横方向）",
      "checkpoints": [
        "ドメイン間の依存関係が適切か（不正な横断参照がないか）",
        "各ドメインが単一責任を持っているか",
        "ドメイン間で共有すべきロジックが適切に lib/ や core/ に配置されているか",
        "ドメイン固有のエンティティが他ドメインから直接参照されていないか",
        "ドメイン間の通信が適切なインターフェース経由で行われているか"
      ],
      "references": [
        "src/features/*/",
        "src/lib/",
        "src/features/core/"
      ],
      "verificationPatterns": [
        { "type": "import_analysis", "description": "features/A/ から features/B/entities/ への直接参照がないこと" },
        { "type": "import_analysis", "description": "共有ロジックが lib/ または core/ にあること" }
      ]
    },
    {
      "id": 4,
      "name": "拡張性・カスタマイズ性",
      "checkpoints": [
        "カスタマイズすべき箇所と触らない箇所の境界が明確か",
        "新規ドメイン追加のワークフローが確立されているか",
        "domain.json から生成されるファイルが適切か",
        "生成コードの上書きと手動編集の共存ルールがあるか",
        "共通処理の拡張ポイントが用意されているか"
      ],
      "references": [
        "docs/how-to/implementation/アプリへの新規ドメイン追加ガイド.md",
        "docs/how-to/utility/ドメインファイル自動生成に関するコマンド使用方法.md",
        "scripts/domain-config/",
        "src/features/*/domain.json"
      ],
      "verificationPatterns": [
        { "type": "file_exists", "path": "scripts/domain-config/" },
        { "type": "glob", "pattern": "src/features/*/domain.json" }
      ]
    },
    {
      "id": 5,
      "name": "コアライブラリの品質",
      "checkpoints": [
        "src/lib/ の各モジュールが安定動作するか",
        "共通コンポーネント（src/components/）が網羅的か",
        "エラーハンドリングが統一されているか（HttpError, DomainError）",
        "CRUD システム（createCrudService）が期待通り動作するか",
        "ユーティリティ関数のドキュメント・型定義が整備されているか"
      ],
      "references": [
        "src/lib/",
        "src/components/",
        "src/components/README.md",
        "docs/core-specs/"
      ],
      "verificationPatterns": [
        { "type": "file_exists", "path": "src/lib/crud/" },
        { "type": "file_exists", "path": "src/lib/errors/" },
        { "type": "file_exists", "path": "src/components/README.md" }
      ]
    },
    {
      "id": 6,
      "name": "ドキュメントの充実度",
      "checkpoints": [
        "CLAUDE.md がプロジェクトの全体像を網羅しているか",
        "docs/ 配下のドキュメントが最新の実装と整合しているか",
        "コードの自己説明性が高いか（適切な命名、必要な箇所のコメント）",
        "必読ドキュメント（!must-read）が開発開始に十分か",
        "トラブルシューティングガイドが実用的か"
      ],
      "references": [
        "CLAUDE.md",
        "docs/",
        "docs/README.md"
      ],
      "verificationPatterns": [
        { "type": "file_exists", "path": "CLAUDE.md" },
        { "type": "file_exists", "path": "docs/README.md" },
        { "type": "file_exists", "path": "docs/!must-read/" }
      ]
    },
    {
      "id": 7,
      "name": "セキュリティ",
      "checkpoints": [
        "入力バリデーションが適切か（SQLインジェクション、XSS対策）",
        "認証・認可の実装が安全か（セッション固定攻撃対策など）",
        "CSRF対策が施されているか",
        "環境変数・シークレットの管理が適切か（漏洩リスクがないか）",
        "エラーメッセージで内部情報が漏洩しないか",
        "依存パッケージに既知の脆弱性がないか"
      ],
      "references": [
        "src/lib/errors/",
        "src/features/core/auth/",
        "src/proxies/",
        ".env.example",
        "package.json"
      ],
      "verificationPatterns": [
        { "type": "grep", "pattern": "zod", "path": "src/features/*/entities/schema.ts", "expect": "exists" },
        { "type": "command", "cmd": "npm audit", "description": "脆弱性チェック" }
      ]
    },
    {
      "id": 8,
      "name": "派生リポジトリへの配慮",
      "checkpoints": [
        "上流（ベース）の変更を派生リポジトリにマージしやすい構造か",
        "変更可能な領域と変更禁止領域が明確に文書化されているか",
        "派生リポジトリ作成時のガイドラインがあるか",
        "ベース固有の設定と案件固有の設定が分離されているか",
        "競合が発生しにくいファイル構成になっているか"
      ],
      "references": [
        "CLAUDE.md（System Core Files セクション）",
        "docs/テンプレート利用ガイド.md"
      ],
      "verificationPatterns": [
        { "type": "section_exists", "file": "CLAUDE.md", "section": "System Core Files" }
      ]
    },
    {
      "id": 9,
      "name": "テスト・品質保証",
      "checkpoints": [
        "ユニットテストのサンプル・パターンが提供されているか",
        "E2E テストの基盤が整備されているか",
        "CI/CD パイプラインが設定されているか",
        "テスト実行方法がドキュメント化されているか",
        "品質を担保するためのレビュー観点が明確か"
      ],
      "references": [
        "__tests__/（存在する場合）",
        ".github/workflows/（存在する場合）",
        "package.json（test スクリプト）",
        "playwright.config.ts（存在する場合）"
      ],
      "verificationPatterns": [
        { "type": "file_exists", "path": "__tests__/" },
        { "type": "file_exists", "path": ".github/workflows/" },
        { "type": "file_exists", "path": "playwright.config.ts" },
        { "type": "script_exists", "name": "test" }
      ]
    }
  ],

  "reviewChecklist": [
    "観点リストの全項目を確認したか",
    "参照先のファイル/ドキュメントを実際に読んだか",
    "俯瞰評価時の仮スコアと乖離がある場合、その理由を説明できるか",
    "「良い点」に見落としがないか",
    "「課題」は具体的で改善可能な形で記述されているか",
    "「推奨アクション」は優先度順に並んでいるか"
  ],

  "outputFormat": {
    "fileName": "YYYY-MM-DD.md",
    "requiredSections": [
      "評価方式",
      "サマリー（項目/スコア/前回比テーブル）",
      "総合評価",
      "詳細評価（各項目: 良い点/課題/推奨アクション）",
      "俯瞰評価との乖離（該当する場合）",
      "次回評価への申し送り"
    ],
    "previousComparisonSymbols": {
      "improved": "↑",
      "unchanged": "→",
      "degraded": "↓",
      "new": "-"
    }
  }
}
