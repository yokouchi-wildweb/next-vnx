
# ✨ Figma MCP を利用したデザイン構築の方法と注意点

デザイナーが作成した Figma のデータを Codex（CLI 上のエージェント）が直接参照し、テキストや色・画像を取り込んで実装するためのガイドです。  
「MCP が何をしているのか」「どのように Figma を組み立てれば正しく情報を渡せるのか」を順番に解説します。技術的な前提がなくても読めるよう、Figma 上の操作はすべて手順付きで記載しています。

---

## 1. 🧠 MCP とは何か、何ができるのか

- **MCP（Model Context Protocol）** は、Figma と Codex をつなぐ仕組みです。  
  Figma 側のレイヤー情報・テキスト・画像を API 経由で取得し、Codex がその内容をもとに HTML/CSS や React などのコードを生成します。
- Codex は CLI から `get_design_context` や `get_metadata` といったツールを呼び出し、指定した node-id（レイヤーID）をもとに情報を取得します。
- MCP を使うことで、デザイナーが作った画面を **手打ちで転記せず** に、ボタンや文章、画像などを正確にコードへ反映できます。

この仕組みが活きるかどうかは、Figma の構造が整理されているかに強く依存します。以下のガイドに沿って構築すると、実装側が迷わず情報を受け取れます。

---

## 2. 🧾 用語リファレンス（Figma でよく使う言葉）

| 用語 | 意味 | 実際の操作例 |
| --- | --- | --- |
| フレーム (Frame) | 画面やセクションを囲む箱。`F` キーで作成し、ページ内のまとまりを作る。 | ヒーローやフッターごとに Frame を用意する |
| レイヤー (Layer) | テキスト・図形・画像といった個別オブジェクト。左側のレイヤーパネルに表示される。 | `hero-title` など意味の分かる名前を付ける |
| グループ (Group) | 複数レイヤーを一時的にまとめる箱。`Ctrl/Cmd + G`。Frame より軽いまとまり。 | アイコン＋テキストをまとめてドラッグしやすくする |
| コンポーネント (Component) | 再利用部品。`Ctrl/Cmd + Alt + K` で登録し、`Assets` から複数箇所で使える。 | ボタンを共通化し、別ページでも同じものを配置する |
| Auto Layout | 子要素を自動で並べてくれる機能。間隔やパディングを設定可能。 | カードを縦に並べて余白を一定に保つ |
| エクスポート設定 (Export) | PNG/SVG 等の書き出し形式。右サイドバー下部で `+` を押す。 | 画像を `public/` 用にダウンロード可能にする |
| node-id | 各レイヤーに付く ID（例: `491:701`）。Codex が MCP からレイヤーを特定するために使用。 | `get_design_context` 実行時に対象セクションを指定する |

---

## 3. 🛠️ デザイン構築の基本方針と具体的手順

### 2-1. 🧩 セクション単位でフレームを分ける
1. 画面全体を 1 つの巨大なフレームにするのではなく、**ヒーロー、コンテンツ、CTA、フッターなどセクションごとにフレームを作る**。
    - 例: `hero`, `pickup-list`, `cta-band`, `footer` といった名前を付ける。
2. Figma では `Frame` ツール（ショートカット `F`）で範囲を囲み、左側のレイヤーパネルで分かりやすい名前に変更する。
3. こうしておくと Codex が node-id を指定しやすく、`get_design_context` で余計な情報を含まずに済みます。
4. **セクションをまたぐ背景や装飾がある場合の対応**
    - 背景全体を覆う画像・グラデーションなどは、レイヤーパネルの最下部（＝背面）に「背景専用フレーム」を 1 つ置き、その上に各セクションフレームを重ねます。  
      例: `background-frame` を最背面に置き、`hero` や `cta` をその上に配置する。
    - どうしても要素がセクションから飛び出す場合は、「飛び出す要素用の小さなフレーム」を作り、`hero-floating-badge` など名称を付けて管理します。
    - 要素をまたがらせたい場合も、どのセクションに属しているか分かる名前付けとフレーム分けをしておくと、Codex が node-id を指定しやすくなります。

### 2-2. 🗂️ レイヤー名と階層を整理する
1. テキストレイヤーには `hero-title`, `section-subtitle` など、意味が分かる名前を付ける。
2. 矢印アイコンやボタンなども `icon-arrow`, `btn-primary` のように命名してグループ化する。
3. レイヤーパネルで「右クリック → Group selection」などを活用し、構造を浅く整理する。
4. **無駄な入れ子は避ける**
    - 四角形の背景や装飾を重ねる際、必要以上に Frame/Group を重ねて入れ子にすると、Codex が node-id を辿るときにどのレイヤーが本体か判別しづらくなります。
    - 「セクションのフレーム → その中にテキストやボタン」といったシンプルな2〜3階層に収めるイメージで作ると、データ取得がスムーズです。

### 2-3. ✍️ テキストは実際の文言で入力する
- `lorem ipsum` や仮文ではなく、**本番想定のコピーをそのまま入力**してください。
- 段落を分けたい場合は `Shift+Enter` で改行し、Figma 上で読みやすい形に整えておくと Codex 側も同じ行分けを再現できます。

### 2-4. 🧱 ボタン・カードなどはコンポーネント化

**コンポーネントの基本概念**
- Figma には部品を「コンポーネント」として登録し、別の画面でも繰り返し使える仕組みがあります。
- 例: ボタンをコンポーネント化しておけば、別ページで同じボタンを使う際に、毎回作成しなくて良いので作業コストを減らし、統一した見た目になります。
- Codex が MCP 経由で情報を取る際も、コンポーネントとして整備されている方が構造を理解しやすく、コードへの反映もスムーズです。

1. 共有したい要素を選択し、`Ctrl/Cmd + Alt + K` でコンポーネント化する。
2. 左側の「Assets」パネルからドラッグして再利用する。
3. Codex が `get_design_context` を呼ぶ際、コンポーネント単位で小さく呼び出せるため、コードの再現性が高まります。

### 2-5. 🖼️ 画像とエクスポート設定
1. 画像レイヤーを選択し、右サイドバー最下部の **Export** セクションで `+` を押す。
2. `PNG` もしくは `SVG` を選び、`Export [レイヤー名]` をクリック。  
   これが「エクスポート設定」です。設定があると `get_design_context` のレスポンス内にダウンロードURLが含まれます。
3. 写真素材は JPEG/PNG、アイコンは可能なら SVG が望ましいです。

### 2-6. 🔁 アイコンの扱い
- できるだけベクター（Outline）で作成する。  
  例: `Pen Tool` や `Rectangle` で描いた図形を組み合わせて、右クリック→`Flatten`。
- ラスタ画像を使わざるを得ない場合も、名称とグループ化を行い、エクスポート設定を付けておくと Codex が取得しやすいです。

### 2-7. 🎨 カラースタイル・テキストスタイル
1. 共通で使う色がある場合は、右側の `Color Styles` で `＋` を押し登録しておく。
2. 見出し・本文の文字設定も `Text Styles` に登録すると、スタイル名を参照しながら実装できます。
3. Codex は `get_variable_defs` を使ってカラースタイルを参照することもあるので、スタイル登録は推奨です。

## 4. ⚠️ デザインや配置の注意事項

1. **Auto Layout のネストは最小限に**
    - Auto Layout を多段に重ねると構造が読みにくくなります。必要な入れ子に絞り、「何を並べるための Auto Layout なのか」が分かるようレイヤー名を付けてください。
2. **非表示レイヤーは使わない**
    - `⌘/Ctrl + Shift + H` などで非表示にしたレイヤーは、取得時に無視される場合があります。最終的に必要な要素は必ず表示状態にしておきます。
3. **マスク・ブーリアンの多用に注意**
    - マスクやブール合成を重ねると、構造のどこにテキストや画像があるのか分かりにくくなります。必要な箇所以外は個別レイヤーで配置し、名前を付けておくと良いです。
4. **テキストはアウトライン化しない**
    - 文字を `Vectorize` すると文字情報が失われ、Codex ではコピーを取得できません。装飾は別レイヤーに分け、テキストは文字のまま残してください。
5. **クリッピングやズレに注意**
    - 「Clip content」を使わないと要素がはみ出してセクションの範囲が不明瞭になることがあります。はみ出しを意図する場合は専用フレームを作るか、名称で意図を伝えてください。
    - 中央に揃えるつもりの要素が数ピクセルずれていると、そのずれが CSS にも反映されます。Figma のアライン機能を使って数値を揃えるようにしましょう。
6. **ロックは必要最低限に**
    - レイヤーをロックしすぎると、他のメンバーが構造を確認しにくい場合があります。ロックを使う場合は命名で役割が分かるようにしておくと親切です。

---

## 5. 🛰️ MCP 連携時の裏側の動き

ここでは、Codex が Figma の情報をどのように取り込んでいるかを概略で説明します。仕組みを知っておくと、どのようなデータが必要なのか理解しやすくなります。

1. **node-id の指定**
    - Figma 上の各レイヤーには `123:456` のような ID が振られています。Codex は「どのフレーム・レイヤーを読みたいのか」を node-id で指定します。
    - 例: `get_design_context (fileKey=..., nodeId=491:701)`。

2. **`get_metadata` で構造把握**
    - まず XML 形式でレイヤー構造だけを取得し、どんなセクション・アイテムがあるかを確認します。
    - この段階でレイヤー名や階層が整っていないと、どこから情報を取ればいいか分かりづらくなります。

3. **`get_design_context` で詳細を取得**
    - 対象セクションごとに実行し、テキスト・色・サイズ・画像URLまでを取得します。
    - 取得結果をもとに、Codex が HTML/CSS（または React + CSS Modules など）へ落とし込みます。

4. **画像ダウンロード**
    - `get_design_context` の結果にはアセットの URL が含まれるため、Codex はそれをダウンロードして `public/` 配下へ保存し、 `<Image src=\"…\" />` として利用します。

5. **レートリミットと呼び出し回数**
    - 1 回の呼び出しで巨大なフレームを取得すると失敗しやすいため、セクション単位で小さく呼び出します。
    - 通常のLP規模なら 10〜15 回程度の呼び出しで十分です。レート制限にかかった場合は一定時間待って再実行します。

このように、Figma の構造が整っていると、Codex はセクション単位で効率的に情報を取得し、ほぼテキスト転記なしで実装へ移れます。

---

## 6. ✅ まとめ

- MCP で Figma→コードの連携を行うには、**セクション単位のフレーム、分かりやすいレイヤー名、実際の文言** が重要です。
- 画像やアイコンには必ずエクスポート設定を付け、再利用要素はコンポーネント化しておきましょう。
- Codex は `get_metadata` → `get_design_context` の順で詳細を取っていくので、構造が素直であるほど実装が早く、忠実に再現できます。

これらの手順を意識してデザインを組むことで、開発チームとの連携が非常にスムーズになり、Figma の変更を素早くプロダクトに反映できます。困ったときは本ドキュメントを参照し、必要であればエンジニアと相談しながらプロセスを整えてください。