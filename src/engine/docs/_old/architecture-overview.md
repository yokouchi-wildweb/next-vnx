# VNエンジン アーキテクチャ概要

## レイヤー構成

```
┌─────────────────────────────────┐
│  オーバーレイPixi層              │  ← 将来拡張用（未実装）
│  (透過Canvas, 普段非表示)        │     トランジション、パーティクル
├─────────────────────────────────┤
│  インタラクティブHTML層          │  ← 中層
│  メッセージ、選択肢、設定UI      │     通常のUI操作
├─────────────────────────────────┤
│  ベースPixi層                   │  ← 最下層
│  背景、立ち絵、常時エフェクト    │     ゲーム世界の描画
└─────────────────────────────────┘
```

## 技術選択の根拠

| 層 | 技術 | 理由 |
|-----|------|------|
| ベースPixi | PixiJS + @pixi/react | 画像処理、フィルター、パフォーマンス |
| HTML | React + framer-motion | フォント、アクセシビリティ、フォーム |
| オーバーレイPixi | PixiJS (将来) | HTMLを含む全体へのエフェクト |

## PixiJS vs HTML の使い分け

### PixiJS向き
- 背景画像
- キャラクター立ち絵
- エフェクト（パーティクル、フィルター）
- トランジション
- 視覚的な演出全般

### HTML向き
- テキスト表示（メッセージボックス）
- 設定画面
- セーブ/ロード画面
- メニュー系UI
- フォーム入力（名前入力など）
- システム的なUI全般

## オーバーレイ演出のCSS代替

オーバーレイPixi層を追加する前に、CSSで実現可能な演出:

| 演出 | CSS実現方法 |
|------|------------|
| フェードイン/アウト | opacity + transition |
| 画面フラッシュ | 白divをopacityアニメーション |
| 暗転 | 黒divをopacityアニメーション |
| 画面揺れ | transform + keyframes |
| ワイプ | clip-path |

CSSで不可能なもの（オーバーレイPixi層が必要）:
- パーティクルエフェクト
- シェーダー演出
- 複雑な形状のワイプ
